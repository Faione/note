## Controllers

- [controllers](https://kubernetes.io/docs/concepts/architecture/controller/)

在机器人与自动化中，控制回路(control loop)是调节系统状态的非终止回路, 其作用类似于房间中的恒温器
在k8s中，控制器(controller)是监控集群状态的控制回路，并根据需要进行更改或请求更改，每个控制器都试图将集群状变化至接近所要达到的状态

### 控制器模式

控制器至少追踪一种k8s资源类型。k8s中的对象包含标识期望状态的spec(specification规约)字段，而该资源对应的控制器负责让对象当前的状态更接近所要求的状态
控制器可能会自己直接进行相关的操作，但在k8s中，更常见的是，控制器发送消息给能够在边侧产生有效影响的API server

**Job控制器工作模式**

当job控制器发现一个新的任务时，就会确保在集群中的一组节点上的kubelet正在运行正确树立的pod，以保证工作的进行。但是job控制器本身并不运行任何Pod或容器，而是告诉API server去创建或移除pod，控制平面中的其他组件会根据新消息(新pod的调度和运行)采取相应的行动，直到工作最终完成
同时，控制器也会更新对象的配置

**直接控制**

一些控制器需要对集群之外的事务进行更改(无法通过api server), 此时，这些控制器会从api server中找到所需的状态，然后直接与外部系统通信以使得当前状态与期望的一致，即控制器进行一些更改以达到期望的状态，然后将当前的状态报告回集群的api server

### 设计

Kubernetes 使用许多控制器，每个控制器都管理集群状态的特定方面。多数情况下，一个特定的控制循环使用某一种资源作为其期望的状态，并能够管理另一种资源以使得期望的状态能够达到。如Job控制器追踪Job资源，并能够管理pod资源