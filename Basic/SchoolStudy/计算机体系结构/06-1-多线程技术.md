# 多线程技术

## 多发射处理器局限

- 工作负载可以使用线程级并行来完成(TLP)
  - 多任务 TLP (运行相互的独立的任务)
  - 多线程 TLP (使用多线程来加速一个任务的运行)

- 基本思想: 使用TLP来提高单个处理器的利用率
  - *多个线程以重叠的方式共享单个处理器的功能单元*
  - 增加相应的功能部件以实现处理器功能单元的共享
    - PC, regs

## 多线程技术基本思想

- 解决一条流水线上的指令之间的数据依赖关系
  - 在相同的流水线中交叉指向来自不同线程的指令
    - 必须传递线程选择信号以保证各流水段读写的正确性
    - 给外部存在多个CPU的假象
      - 对每个线程而言，执行速度相对变慢

## 线程调度方式

- 固定交叉模式
  - 对于N个线程，每条线程每隔N个周期执行一条指令
    - 每个线程分配固定的时隙
  - 流水线某一时隙对应线程未就绪，则插入pipline bubble
    - 潜在地消除旁路和互锁逻辑
- 软件控制的交叉模式
  - OS为N个线程分配流水线的S个流水线时隙
    - 每个线程的时隙可以同，但仍然是周期性地执行
    - 如线程 A 每隔 1 个流水线周期执行一次，B每隔3个流水周期执行一次
    - 依据Priority差异
  - 硬件对于S个时隙采用固定交叉模式执行相应的线程
- 硬件控制的线程调度
  - 硬件跟踪处于ready状态的线程
  - 根据优先级方案选择线程执行
    - 不再是周期性的执行，而是切换式地执行
    - A执行n个周期，B紧接着执行m个周期

## 多线程处理器分类