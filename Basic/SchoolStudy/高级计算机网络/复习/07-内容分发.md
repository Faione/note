## 七、内容分发

### 1. 背景

#### 1.1 问题描述

存在的问题
- 性能问题
- 访问的局部性
  - 符合 80-20原则
  - zipf定律

解决方法
- Web Cache
  - 在靠近用户网络的地方缓存流行内容, 后续请求不需要再到原服务器
  - 运营商采用, 节省流量
- CDN
  - 把内容拷贝到不同地域的多台服务器, 分摊服务器负载, 提升用户服务质量
  - 内容提供商采用, 提升用户感知质量  

#### 1.2 Web缓存: 被动模式

不足
- 版权问题、内容更新问题：类似于劫持(变更用户访问原服务器的请求)
- 支持缓存的内容类型有限
  - 动态数据：股票信息
  - 依赖于参数或Cookies的数据
  - 加密的数据(HTTPS): 80%以上的流量 

#### 1.3 CDN: 主动发布内容

Content Delivery Network

原始服务器向CDN分发节点发布内容
不同区域部署的服务器，主动向CDN分发节点复制内容

### 2. 核心问题及方案

#### 2.1 CND服务器选择

用户端请求应当选择发送给那个服务器
   - 一般选择距离客户端近的服务器(基于距离或RTT)
   - 负载轻、性能高(处理能力、带宽)、成本低

##### 2.1.1 EDNS: 用户->CDN服务器的映射



#### 2.2 CND服务器缓存内容

利用早期流行度预测整个生命周期流行度


存储不下问题解决
- 部分缓存
  - 内容级别: 非流行内容不存储多份
  - 内容块级别: 只存储部分内容块(如视频开头) 
- 缓存替换
  - LRU、LFU 
    - B-LRU: 大部分内容(~70%) 只请求一次，用Bloom filter记录是否请求过，大于两次进入缓存 



### 3. CDN与视频

视频采用分块传输: 一个Chunk对于几秒的内容
- 便于在传输过程中切换码率

#### 3.1 DASH

视频流传输以基于HTTP的动态自适应流(DASH)作为通用技术标准

#### 3.2 视频直播系统

传统直播系统时延迟
- 成本高、延迟大：路径长、汇聚带宽要求高

阿里GRTN
- 扁平化，协议统一

### 4. 边缘计算与CDN

#### 4.1 P2P