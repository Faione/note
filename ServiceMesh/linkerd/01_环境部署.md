## 环境部署(helm)


https://linkerd.io/what-is-a-service-mesh/
### 安装linkerd cni

helm repo update

helm install linkerd-cni -n linkerd-cni --create-namespace linkerd/linkerd2-cni

# To add the repo for Linkerd stable releases:
helm repo add linkerd https://helm.linkerd.io/stable

# To add the repo for Linkerd edge releases:
helm repo add linkerd-edge https://helm.linkerd.io/edge


### 安装crd

helm install linkerd-crds linkerd/linkerd-crds \
  --set cniEnabled=true \
  -n linkerd --create-namespace 


helm install linkerd-control-plane \
  -n linkerd \
  --set cniEnabled=true \
  --set-file identityTrustAnchorsPEM=ca.crt \
  --set-file identity.issuer.tls.crtPEM=issuer.crt \
  --set-file identity.issuer.tls.keyPEM=issuer.key \
  linkerd/linkerd-control-plane


```
tcp_open_total{
  app="emoji-svc",
  client_id="web.emojivoto.serviceaccount.identity.linkerd.cluster.local",
  control_plane_ns="linkerd",
  deployment="emoji",
  direction="inbound",
  instance="172.17.0.10:4191",
  job="linkerd-proxy",
  namespace="emojivoto",
  peer="src",
  pod="emoji-55c59cf485-rkszq",
  pod_template_hash="55c59cf485",
  srv_kind="default",
  srv_name="all-unauthenticated",
  target_addr="172.17.0.10:8080",
  target_ip="172.17.0.10",
  target_port="8080",
  tls="true",
  version="v11",
  workload_ns="emojivoto"}


http_client_requests_total{
  client="k8s",
  code="200",
  component="destination",
  instance="172.17.0.4:9996",
  job="linkerd-controller",
  method="get"}
```
