# 作业与习题

- [作业与习题](#作业与习题)
  - [集中式共享Cache一致性](#集中式共享cache一致性)
    - [一](#一)
  - [基于目录Cache一致性](#基于目录cache一致性)
    - [一](#一-1)
    - [二](#二)
  - [VLIW超长指令字](#vliw超长指令字)
    - [一](#一-2)
    - [二](#二-1)
  - [GPU体系结构](#gpu体系结构)
    - [一](#一-3)

## 集中式共享Cache一致性

### 一

- 假设在一个双CPU多处理器系统中，两个CPU用单总线连接，并且采用监听一致性协议（MSI），cache的初始状态均为无效，然后两个CPU对内存中同一块数据进行如下操作：CPU A读、CPU A写、CPU B写、CPU A读，写出每次访问后两个CPU各自的cache的状态变化

|   事件   | A状态 | B状态 |
| :------: | :---: | :---: |
| 初始状态 |   I   |   I   |
| CPU A读  |   S   |   I   |
| CPU A写  |   M   |   I   |
| CPU B写  |   I   |   M   |
| CPU A读  |   S   |   S   |

## 基于目录Cache一致性

### 一

- 在基于目录的Cache一致性系统中，目录记载了P1处理器已经有数据块A的备份
  - （1）在哪些情况下，目录又会收到一个P1对A块访问的请求
  - （2）如何正确处理上述情况？

### 二

- A、B、C、D为进程P1，P2，P3的共享变量，且初始值均为0，该程序执行结果为D=2000，在基于目录的Cache一致性系统中，运行结果是D=0，请解释原因

|   P1   |       P2       |       P3       |
| :----: | :------------: | :------------: |
| A=2000 | while(B!=1){;} | while(C!=1){;} |
|  B=1   |      C=1       |      D=A       |

## VLIW超长指令字

### 一

- 超长指令字 （VLIW） 设计人员在寄存器使用的体系结构规则方面需要做出一些基本选择。假设 VLIW 设计了自耗尽的执行流水线：一旦启动了操作，其结果将在以后最多 L 个周期出现在目标寄存器中（其中 L 是操作的延迟）。寄存器是永远不够用的，因此希望从现有寄存器中得到最大使用率。请考虑下图。如果负载具有 1 + 2 个周期的延迟，请展开此循环一次，并显示在 没有任何流水线中断或停顿的情况下，每个周期能够进行两次加载和两次添加的 VLIW 如何使用最小数量的寄存器。在存在自耗尽流水线的时，说明一种可能会破坏流水线并产生错误的结果的情况。

![](./img/2022-06-15-13-09-17.png)

### 二

- 假设一个 VLIW 处理器的指令包含五个操作，如图所示。我们将比较两个循环展开的程度。首先，展开循环 6 次以获取并规划ILP，使其没有任何stall（即完全空的事件周期），折叠循环开销指令。并重复该方法但展开循环10 次。忽略分支延迟间隙。写出两个规划。每个规划的结果向量的每个元素的执行时间是多少？每个规划中使用的操作间隙的百分比是多少？两个规
划之间的代码大小有多大差异？这两个规划的总寄存器需求是多少？

![](./img/2022-06-15-13-10-39.png)

## GPU体系结构

### 一

- 假定有一种包含10个 SlMD 处理器的 GPU 体系结构。每条 SIMD 指令的宽度为32，每个SIMD 处理器包含8个车道（lane）,用于执行单精度运算和载入/存储指令，也就是说，每个非分岔 SIMD 指令每4个时钟周期可以生成32个结果。假定内核的分岔分支将导致平均80%的线程为活动的。假定在所执行的全部 SIMD 指令中，70%为单精度运算、20%为载入/ 存储。由于并不包含所有存储器延迟，所以假定 SIMD 指令平均发射率为0.85。假定 GPU 的时钟速度为1.5 GHZ
- a. 计算这个内核在这个GPU上的吞吐量,单位为GFLOP/S
- b. 假定我们有以下选项
  1. 将单精度车道数增大至16
  2. 将SIMD处理器数增大至15 (假定这一改变不会影响所有其他性能度量,代码会扩展到增加的处理器上)
  3. 添加缓存可以有效地将存储器延迟缩减40%，这样会将指令发射率增加至0.95，对于这些改进中的每一项
  - 吞吐量的加速比为多少